angular.module("gigPlanner",["ngResource","ui.router","templates","ui.bootstrap"]),angular.module("gigPlanner").constant("AuthEvents",{logout:"auth-logout"}),angular.module("gigPlanner").config(["$httpProvider","$resourceProvider",function(e,n){e.interceptors.push("authInterceptor"),angular.extend(n.defaults.actions,{update:{method:"PUT"}})}]),angular.module("gigPlanner").run(["$rootScope","Account","AuthEvents","api","$state",function(e,n,a,r,t){r.setToken(),n.init(),e.$on(a.logout,n.logout),e.$on("$stateChangeStart",function(e,a){a.data&&a.data.auth&&(n.isLoggedIn()||(e.preventDefault(),t.go("login")))})}]),angular.module("gigPlanner").config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/dashboard"),e.state("dashboard",{url:"/dashboard",controller:"DashboardController",templateUrl:"views/dashboard.html"}).state("login",{url:"/login",controller:"LoginController",templateUrl:"views/login.html"}).state("signup",{url:"/signup",controller:"SignupController",templateUrl:"views/signup.html"}).state("users",{url:"/users",controller:"UserController",templateUrl:"views/users.html",data:{auth:!0}}).state("user",{url:"/users/:id",controller:"UserDetailController",templateUrl:"views/user.html",data:{auth:!0}}).state("bands",{url:"/bands",controller:"BandController",templateUrl:"views/bands.html",data:{auth:!0}}).state("band",{url:"/bands/:id",controller:"BandDetailController",templateUrl:"views/band.html",data:{auth:!0}}).state("events",{url:"/events",controller:"EventController",templateUrl:"views/events.html",data:{auth:!0}}).state("event",{url:"/events/:id",controller:"EventDetailController",templateUrl:"views/event.html",data:{auth:!0}})}]),angular.module("templates",[]).run(["$templateCache",function(e){e.put("views/band.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li><a ui-sref="bands">Bands</a></li>\n    <li class="active">{{ band.name }}</li>\n</ol>\n\n\n<h1>{{ band.name }}</h1>\n\n<form class="form-horizontal" name="editBandForm" ng-submit="band.$update()">\n    <div class="form-group">\n        <label for="name" class="col-sm-2">Naam</label>\n        <div class="col-sm-10">\n            <input type="text" ng-model="band.name" class="form-control" id="name" placeholder="Guns n Roses" required>\n        </div>\n    </div>\n    <button type="submit" ng-disabled="editBandForm.$invalid">Save</button>\n</form>\n\n<h2>Bandmembers</h2>\n<div><button ng-click="selectUser()">Select user</button></div>\n<br/>\n<div class="alert alert-warning" ng-if="error">{{ error }}</div>\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th>Verwijder</th>\n    </tr>\n    <tr ng-repeat="member in band.members">\n        <td><a ui-sref="user({id:member.user._id})">{{ member.user.name.full }}</a></td>\n\n        <td><button ng-click="band.$removeMember({id: band._id, memberId: member._id})">Remove member</button></td>\n    </tr>\n</table>'),e.put("views/bands.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li class="active">Bands</li>\n</ol>\n\n<h1>Bands</h1>\n\n<form class="form-inline" ng-submit="addBand(newBand)" name="addBandForm">\n    <div class="form-group">\n        <label for="name">Naam</label>\n        <input type="text" ng-model="newBand.name" class="form-control" id="name" placeholder="Guns n Roses" required>\n    </div>\n    <button type="submit" ng-disabled="addBandForm.$invalid">Add Band</button>\n</form>\n<br/>\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th>Verwijder</th>\n    </tr>\n    <tr ng-repeat="band in bands">\n        <td><a ui-sref="band({id:band._id})">{{ band.name }}</a></td>\n\n        <td><button ng-click="deleteBand(band)">Delete</button></td>\n    </tr>\n</table>'),e.put("views/dashboard.html","<h1>Welkom</h1>\n<p>GigPlanner is een work in progress.</p>"),e.put("views/event.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li><a ui-sref="events">Events</a></li>\n    <li class="active">{{ event.name }}</li>\n</ol>\n\n\n<h1>{{ event.name }}</h1>\n\n<form class="form-horizontal" name="editEventForm" ng-submit="event.$update()">\n    <div class="form-group">\n        <label for="name" class="col-sm-2">Naam</label>\n        <div class="col-sm-10">\n            <input type="text" ng-model="event.name" class="form-control" id="name" placeholder="Lowlands" required>\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="date" class="col-sm-2">Datum</label>\n        <div class="col-sm-10">\n            <input type="date" ng-model="event.date" class="form-control" id="date" required>\n        </div>\n    </div>\n    <button type="submit" ng-disabled="editEventForm.$invalid">Save</button>\n</form>\n\n<div class="row">\n    <div class="col-sm-6">\n        <h2>Bands</h2>\n        <div><button ng-click="selectBand()">Select band</button></div>\n        <br/>\n        <div class="alert alert-warning" ng-if="errorBands">{{ errorBands }}</div>\n\n        <table class="table table-striped table-hover">\n            <tr>\n                <th>Name</th>\n                <th>Delete</th>\n            </tr>\n            <tr ng-repeat="band in event.bands">\n                <td><a ui-sref="band({id:band.band._id})">{{ band.band.name }}</a></td>\n\n                <td><button ng-click="event.$removeBand({docId: band._id})">Remove band</button></td>\n            </tr>\n        </table>\n    </div>\n    <div class="col-sm-6">\n        <h2>Users</h2>\n        <div><button ng-click="selectUser()">Select user</button></div>\n        <br/>\n        <div class="alert alert-warning" ng-if="errorUsers">{{ errorUsers }}</div>\n\n        <table class="table table-striped table-hover">\n            <tr>\n                <th>Name</th>\n                <th>Delete</th>\n            </tr>\n            <tr ng-repeat="user in event.users">\n                <td><a ui-sref="band({id:user.user._id})">{{ user.user.name.full }}</a></td>\n\n                <td><button ng-click="event.$removeUser({docId: user._id})">Remove user</button></td>\n            </tr>\n        </table>\n    </div>\n</div>'),e.put("views/events.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li class="active">Events</li>\n</ol>\n\n<h1>Events</h1>\n\n<form class="form-inline" ng-submit="addEvent(newEvent)" name="addEventForm">\n    <div class="form-group">\n        <label for="name">Naam</label>\n        <input type="text" ng-model="newEvent.name" class="form-control" id="name" placeholder="The Big Event" required>\n    </div>\n    <div class="form-group">\n        <label for="date">Datum</label>\n        <input type="date" ng-model="newEvent.date" class="form-control" id="date" required>\n    </div>\n    <button type="submit" ng-disabled="addEventForm.$invalid">Add Event</button>\n</form>\n<br/>\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th>Datum</th>\n        <th>Verwijder</th>\n    </tr>\n    <tr ng-repeat="event in events">\n        <td><a ui-sref="event({id:event._id})">{{ event.name }}</a></td>\n        <td>{{ event.date | date:\'d MMMM yyyy\' }}</td>\n        <td><button ng-click="deleteEvent(event)">Delete</button></td>\n    </tr>\n</table>'),e.put("views/login.html",'<h2>Login with: </h2>\n<ul>\n    <li><a href="http://localhost:8080/auth/facebook">Facebook</a></li>\n</ul>\n\n<h2>Login locally: </h2>\n\n<form ng-submit="login()" class="form-horizontal" name="loginForm">\n    <div class="form-group">\n        <label for="username" class="col-sm-2">Email:</label>\n        <div class="col-sm-10">\n            <input type="email" id="username" ng-model="user.username" class="form-control">\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="password" class="col-sm-2">Password:</label>\n        <div class="col-sm-10">\n            <input type="password" id="password" ng-model="user.password" class="form-control">\n        </div>\n    </div>\n    <input type="submit" value="Login">\n</form>\n<hr />\n<a ui-sref="signup">Or signup here</a>\n\n'),e.put("views/signup.html",'<h2>Sign up</h2>\n\n<p>\n    <small>Or sign in with <a href="/auth/facebook">Facebook</a></small><br/>\n    <small>Already have an account? <a ui-sref="login">Login here</a></small>\n</p>\n\n<form novalidate ng-submit="signup()" class="form-horizontal" name="signupForm">\n    <div class="alert alert-warning" ng-if="signupError">{{ signupError }}</div>\n    <div class="form-group">\n        <label for="email" class="col-sm-2">Email (login):</label>\n        <div class="col-sm-10">\n            <input type="email" id="email" name="email" ng-model="user.email" class="form-control" required>\n        </div>\n    </div>\n    <div class="alert alert-warning" ng-if="signupForm.$submitted && signupForm.email.$invalid">Emailaddress is invalid</div>\n\n    <div class="form-group">\n        <label for="firstName" class="col-sm-2">First name:</label>\n        <div class="col-sm-10">\n            <input type="text" id="firstName" name="firstName" ng-model="user.name.first" class="form-control" required>\n        </div>\n    </div>\n    <div class="alert alert-warning" ng-if="signupForm.$submitted && signupForm.firstName.$invalid">First name is required</div>\n    <div class="form-group">\n        <label for="middleName" class="col-sm-2">Middle name:</label>\n        <div class="col-sm-10">\n            <input type="text" id="middleName" name="middleName" ng-model="user.name.middle" class="form-control">\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="lastName" class="col-sm-2">Last name:</label>\n        <div class="col-sm-10">\n            <input type="text" id="lastName" name="lastName" ng-model="user.name.last" class="form-control" required>\n        </div>\n    </div>\n    <div class="alert alert-warning" ng-if="signupForm.$submitted && signupForm.lastName.$invalid">Last name is required</div>\n    <div class="form-group">\n        <label for="password" class="col-sm-2">Password:</label>\n        <div class="col-sm-10">\n            <input type="password" id="password" name="password" ng-model="user.password" class="form-control" required>\n        </div>\n    </div>\n    <div class="alert alert-warning" ng-if="signupForm.$submitted && signupForm.password.$invalid">Password is required</div>\n\n    <div class="form-group">\n        <label for="confirmPassword" class="col-sm-2">Confirm password:</label>\n        <div class="col-sm-10">\n            <input type="password" id="confirmPassword" name="confirmPassword" ng-model="user.confirmPassword" class="form-control" confirm-value="user.password">\n        </div>\n    </div>\n    <div class="alert alert-warning" ng-if="signupForm.$submitted && signupForm.confirmPassword.$invalid">Passwords should match</div>\n\n    <input type="submit" value="Login" >\n</form>'),e.put("views/user.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li><a ui-sref="users">Users</a></li>\n    <li class="active">{{ user.name.full }}</li>\n</ol>\n\n\n<h1>{{ user.name.full }}</h1>\n\n<form class="form-horizontal" name="editUserForm" ng-submit="user.$update()">\n    <div class="form-group">\n        <label for="first-name" class="col-sm-2">Naam</label>\n        <div class="col-sm-10">\n            <input type="text" ng-model="user.name.first" class="form-control" id="first-name" placeholder="John" required>\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="middle-name" class="col-sm-2">Tussen</label>\n        <div class="col-sm-10">\n            <input type="text" ng-model="user.name.middle" class="form-control" id="middle-name" placeholder="the" size="5">\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="last-name" class="col-sm-2">Achternaam</label>\n        <div class="col-sm-10">\n            <input type="text" ng-model="user.name.last" class="form-control" id="last-name" placeholder="Doe" required>\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="email" class="col-sm-2">Email</label>\n        <div class="col-sm-10">\n            <input type="email" ng-model="user.email" class="form-control" id="email" placeholder="me@hotmail.com" required>\n        </div>\n    </div>\n    <div class="form-group">\n        <label for="password" class="col-sm-2">Wijzig password</label>\n        <div class="col-sm-10">\n            <input type="password" ng-model="user.password" class="form-control" id="password" placeholder="***" >\n        </div>\n    </div>\n    <button type="submit" ng-disabled="editUserForm.$invalid">Save</button>\n</form>\n'),e.put("views/users.html",'<ol class="breadcrumb">\n    <li><a ui-sref="dashboard">Home</a></li>\n    <li class="active">Users</li>\n</ol>\n\n<h1>Users</h1>\n\n<form class="form-inline" ng-submit="addUser(newUser)" name="addUserForm">\n    <div class="form-group">\n        <label for="first-name">Naam</label>\n        <input type="text" ng-model="newUser.name.first" class="form-control" id="first-name" placeholder="John" required>\n    </div>\n    <div class="form-group">\n        <label for="middle-name" class="sr-only">Tussen</label>\n        <input type="text" ng-model="newUser.name.middle" class="form-control" id="middle-name" placeholder="the" size="5">\n    </div>\n    <div class="form-group">\n        <label for="last-name" class="sr-only">Achternaam</label>\n        <input type="text" ng-model="newUser.name.last" class="form-control" id="last-name" placeholder="Doe" required>\n    </div>\n    <div class="form-group">\n        <label for="email">Email</label>\n        <input type="email" ng-model="newUser.email" class="form-control" id="email" placeholder="me@hotmail.com" required>\n    </div>\n    <div class="form-group">\n        <label for="password">Password</label>\n        <input type="password" ng-model="newUser.password" class="form-control" id="password" placeholder="***" required>\n    </div>\n    <button type="submit" ng-disabled="addUserForm.$invalid">Add User</button>\n</form>\n<br/>\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th>Leeftijd</th>\n        <th>Verwijder</th>\n    </tr>\n    <tr ng-repeat="user in users">\n        <td><a ui-sref="user({id: user._id})">{{ user.name.full }}</a></td>\n        <td>{{ user.email }}</td>\n        <td><button ng-click="deleteUser(user)">Delete</button></td>\n    </tr>\n</table>'),e.put("views/modals/SelectBand.html",'<h3>Select a user</h3>\n\n<div>\n    <input type="text" id="filter" class="form-control" ng-model="filter" placeholder="Search in bands...">\n</div>\n\n<form class="form-inline" ng-submit="addBand(newBand)" name="addBandForm">\n    <div class="form-group">\n        <label for="name">Naam</label>\n        <input type="text" ng-model="newBand.name" class="form-control" id="name" placeholder="Guns n Roses" required>\n    </div>\n    <button type="submit" ng-disabled="addBandForm.$invalid">Add Band</button>\n</form>\n<br/>\n\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th></th>\n    </tr>\n    <tr ng-repeat="band in bands |filter:filter | limitTo:10:((currentPage-1)*10)">\n        <td>{{ band.name }}</td>\n        <td><button ng-click="$close(band)">Choose</button></td>\n    </tr>\n</table>\n\n<uib-pagination total-items="bands.length" ng-model="currentPage"></uib-pagination>'),e.put("views/modals/SelectUser.html",'<h3>Select a user</h3>\n\n<div>\n    <input type="text" id="filter" class="form-control" ng-model="filter" placeholder="Search in users...">\n</div>\n\n<form class="form-inline" ng-submit="addUser(newUser)" name="addUserForm">\n    <div class="form-group">\n        <label for="first-name">Naam</label>\n        <input type="text" ng-model="newUser.name.first" class="form-control" id="first-name" placeholder="John" required>\n    </div>\n    <div class="form-group">\n        <label for="middle-name" class="sr-only">Tussen</label>\n        <input type="text" ng-model="newUser.name.middle" class="form-control" id="middle-name" placeholder="the" size="5">\n    </div>\n    <div class="form-group">\n        <label for="last-name" class="sr-only">Achternaam</label>\n        <input type="text" ng-model="newUser.name.last" class="form-control" id="last-name" placeholder="Doe" required>\n    </div>\n    <div class="form-group">\n        <label for="email">Email</label>\n        <input type="email" ng-model="newUser.email" class="form-control" id="email" placeholder="me@hotmail.com" required>\n    </div>\n    <div class="form-group">\n        <label for="password">Password</label>\n        <input type="password" ng-model="newUser.password" class="form-control" id="password" placeholder="***" required>\n    </div>\n    <button type="submit" ng-disabled="addUserForm.$invalid">Add User</button>\n</form>\n<br/>\n\n\n<table class="table table-striped table-hover">\n    <tr>\n        <th>Naam</th>\n        <th></th>\n    </tr>\n    <tr ng-repeat="user in users |filter:filter | limitTo:10:((currentPage-1)*10)">\n        <td>{{ user.name.full }}</td>\n        <td><button ng-click="$close(user)">Choose</button></td>\n    </tr>\n</table>\n\n<uib-pagination total-items="users.length" ng-model="currentPage"></uib-pagination>')}]),angular.module("gigPlanner").controller("ApplicationController",["$scope","Account",function(e,n){e.account=n}]),angular.module("gigPlanner").controller("BandController",["$scope","Band",function(e,n){e.bands=n.query(),e.deleteBand=function(n){n.$delete(function(){var a=e.bands.indexOf(n);e.bands.splice(a,1)})},e.addBand=function(a){e.savingBand=!0,n.save(a,function(n){e.newBand={},e.bands.push(n)}).$promise["finally"](function(){e.savingBand=!1})}}]),angular.module("gigPlanner").controller("BandDetailController",["Band","$scope","$stateParams","$timeout","$filter","Modal",function(e,n,a,r,t,l){n.band=e.get({id:a.id}),n.selectUser=function(){var e=n.band.members.map(function(e){return e.user._id});l.open("SelectUser",{selected:e}).then(function(e){n.band.$addMember({id:n.band._id,userId:e._id})["catch"](function(e){n.error=e.data,r(function(){n.error=null},1e3)})})}}]),angular.module("gigPlanner").controller("DashboardController",["User","$scope",function(e,n){}]),angular.module("gigPlanner").controller("EventController",["$scope","Event",function(e,n){n.query(function(n){e.events=n}),e.deleteEvent=function(n){n.$delete(function(){var a=e.events.indexOf(n);e.events.splice(a,1)})},e.addEvent=function(a){e.savingEvent=!0,n.save(a,function(n){e.newEvent={},e.events.push(n)}).$promise["finally"](function(){e.savingEvent=!1})}}]),angular.module("gigPlanner").controller("EventDetailController",["Event","$scope","$stateParams","Modal","$timeout",function(e,n,a,r,t){n.event=e.get({id:a.id}),n.selectUser=function(){var e=n.event.users.map(function(e){return e.user._id});r.open("SelectUser",{selected:e}).then(function(e){n.event.$addUser({userId:e._id})["catch"](function(e){n.usersError=e.data,t(function(){n.usersError=null},1e3)})})},n.selectBand=function(){var e=n.event.bands.map(function(e){return e.band._id});r.open("SelectBand",{selected:e}).then(function(e){n.event.$addBand({bandId:e._id})["catch"](function(e){n.bandsError=e.data,t(function(){n.bandsError=null},1e3)})})}}]),angular.module("gigPlanner").controller("LoginController",["$scope","$state","Account",function(e,n,a){e.user={username:"admin@gigplanner.nl",password:123456},e.login=function(){a.login(e.user).then(function(){n.go("dashboard")})["catch"](function(e){})}}]),angular.module("gigPlanner").controller("SignupController",["$scope","$state","Account",function(e,n,a){e.user={},e.signup=function(){a.signup(e.user).then(function(){n.go("dashboard")})["catch"](function(n){"404"==n.status?e.signupError="Connection lost. Please try again later.":e.signupError=n.data})}}]),angular.module("gigPlanner").controller("UserController",["User","$scope",function(e,n){n.users=e.query(),n.deleteUser=function(e){e.$delete(function(){var a=n.users.indexOf(e);n.users.splice(a,1)})},n.addUser=function(a){n.savingUser=!0,e.save(a,function(e){n.newUser={},n.users.push(e)}).$promise["finally"](function(){n.savingUser=!1})}}]),angular.module("gigPlanner").controller("UserDetailController",["User","$scope","$stateParams",function(e,n,a){n.user=e.get({id:a.id})}]),angular.module("gigPlanner").directive("confirmValue",function(){return{require:"ngModel",scope:{otherModelValue:"=confirmValue"},link:function(e,n,a,r){r.$validators.confirmValue=function(n){return n==e.otherModelValue},e.$watch("otherModelValue",function(){r.$validate()})}}}),angular.module("gigPlanner").controller("SelectBandModalController",["Band","$scope","$modalInstance",function(e,n,a){e.query(function(e){n.bands=_.filter(e,function(e){return!_.contains(a.$data.selected,e._id)})}),n.currentPage=1,n.addBand=function(a){e.save(a,n.$close)}}]),angular.module("gigPlanner").controller("SelectUserModalController",["User","$scope","$modalInstance",function(e,n,a){e.query(function(e){n.users=_.filter(e,function(e){return!_.contains(a.$data.selected,e._id)})}),n.currentPage=1,n.addUser=function(a){e.save(a,n.$close)}}]),angular.module("gigPlanner").service("Account",["$state","$http","api",function(e,n,a){var r=function(e){e&&e.data&&angular.copy(e.data,t.user)},t={user:{},init:function(){return n.get("/auth/currentUser").then(r)},logout:function(){angular.copy({},t.user),a.clearToken(),e.go("login")},login:function(e){return n.post("/auth/login",e).then(r)},isLoggedIn:function(){return!!localStorage.gp_auth_token},signup:function(e){return n.post("/auth/signup",e).then(r)}};return t}]),angular.module("gigPlanner").service("api",["$location",function(e){return{setToken:function(n){n=n||e.search().auth_token,e.search("auth_token",null),n&&(localStorage.gp_auth_token=decodeURI(n))},clearToken:function(){localStorage.gp_auth_token&&localStorage.removeItem("gp_auth_token")}}}]),angular.module("gigPlanner").factory("authInterceptor",["AuthEvents","$rootScope","$q","$location","api",function(e,n,a,r,t){return{request:function(e){return e.headers.Authorization=localStorage.gp_auth_token,e},response:function(e){return t.setToken(e.headers().authorization),e},responseError:function(r){return"401"==r.status&&(n.$broadcast(e.logout),t.clearToken()),a.reject(r)}}}]),angular.module("gigPlanner").factory("Band",["$resource",function(e){return e("/api/bands/:id",{id:"@_id"},{update:{method:"PUT",transformRequest:function(e){return delete e.members,angular.toJson(e)}},addMember:{method:"POST",url:"/api/bands/:id/members/:userId",params:{userId:"@userId",id:"@id"}},removeMember:{method:"DELETE",url:"/api/bands/:id/members/:memberId",params:{memberId:"@memberId",id:"@id"}}})}]),angular.module("gigPlanner").factory("Event",["$resource",function(e){return e("/api/events/:id",{id:"@_id"},{update:{method:"PUT"},addUser:{method:"POST",url:"/api/events/:id/users/:userId"},removeUser:{method:"DELETE",url:"/api/events/:id/users/:docId"},addBand:{method:"POST",url:"/api/events/:id/bands/:bandId"},removeBand:{method:"DELETE",url:"/api/events/:id/bands/:docId"}})}]),angular.module("gigPlanner").service("Modal",["$uibModal",function(e){return{open:function(n,a,r){var t={templateUrl:"views/modals/"+n+".html",controller:n+"ModalController"};angular.extend(t,r);var l=e.open(t);return l.$data=a,l.result}}}]),angular.module("gigPlanner").factory("User",["$resource",function(e){return e("/api/users/:id",{id:"@_id"},{update:{method:"PUT"}})}]);